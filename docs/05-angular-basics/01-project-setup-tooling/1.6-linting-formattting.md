# 1.6 Linting, Formatting, Testing Setup

**Branch: `1-6-linting-formatting-testing-setup`**

Professional Angular projects require automated quality gates: ESLint for code quality, Prettier for formatting consistency, and comprehensive testing setup.

## ESLint Setup (Angular ESLint)

**Install Angular ESLint schematics:**

```bash
ng add @angular-eslint/schematics
```

**Root .eslintrc.json:**

```json
{
  "$schema": "./node_modules/@angular-eslint/schematics/node_modules/@angular-devkit/core/schema.json",
  "extends": [
    "plugin:@angular-eslint/recommended",
    "plugin:@angular-eslint/template/process-inline-templates",
    "@angular-eslint/template/recommended",
    "plugin:@typescript-eslint/recommended",
    "prettier"
  ],
  "ignorePatterns": ["!**/*"],
  "overrides": [
    {
      "files": ["*.ts"],
      "rules": {
        "@angular-eslint/directive-selector": [
          "error",
          { "type": "attribute", "prefix": "app", "style": "camelCase" }
        ],
        "@angular-eslint/component-selector": [
          "error",
          { "type": "element", "prefix": "app", "style": "kebab-case" }
        ],
        "@typescript-eslint/no-explicit-any": "error",
        "@typescript-eslint/prefer-const": "error"
      }
    },
    {
      "files": ["*.html"],
      "extends": ["plugin:@angular-eslint/template/recommended"],
      "rules": {}
    }
  ]
}
```

## Prettier Configuration

**.prettierrc:**

```json
{
  "semi": true,
  "trailingComma": "es5",
  "singleQuote": true,
  "printWidth": 100,
  "tabWidth": 2,
  "useTabs": false,
  "bracketSpacing": true,
  "overrides": [
    {
      "files": "*.ts",
      "options": {
        "parser": "typescript"
      }
    },
    {
      "files": "*.html",
      "options": {
        "parser": "angular"
      }
    }
  ]
}
```

**prettier.config.js (alternative):**

```javascript
module.exports = {
  semi: true,
  singleQuote: true,
  trailingComma: "es5",
  printWidth: 100,
};
```

## Testing Configuration

**angular.json test configuration:**

```json
{
  "architect": {
    "test": {
      "builder": "@angular-devkit/build-angular:karma",
      "options": {
        "polyfills": ["zone.js", "zone.js/testing"],
        "tsConfig": "tsconfig.spec.json",
        "assets": ["src/favicon.ico", "src/assets"],
        "styles": ["src/styles.scss"],
        "scripts": []
      }
    },
    "lint": {
      "builder": "@angular-eslint/builder:lint",
      "options": {
        "lintFilePatterns": ["src/**/*.ts", "src/**/*.html"]
      }
    }
  }
}
```

**tsconfig.spec.json:**

```json
{
  "extends": "./tsconfig.json",
  "compilerOptions": {
    "outDir": "./out-tsc/spec",
    "types": ["jasmine"]
  },
  "include": ["src/**/*.spec.ts", "src/**/*.d.ts"]
}
```

## VS Code Integration (.vscode/settings.json)

```json
{
  "editor.formatOnSave": true,
  "editor.codeActionsOnSave": {
    "source.fixAll.eslint": true,
    "source.organizeImports": true
  },
  "eslint.validate": ["typescript", "html"],
  "[typescript]": {
    "editor.defaultFormatter": "esbenp.prettier-vscode"
  },
  "[html]": {
    "editor.defaultFormatter": "esbenp.prettier-vscode"
  },
  "typescript.preferences.quoteStyle": "single"
}
```

## Package.json Scripts

```json
{
  "scripts": {
    "lint": "ng lint",
    "lint:fix": "ng lint --fix",
    "format": "prettier --write .",
    "format:check": "prettier --check .",
    "test": "ng test",
    "test:watch": "ng test --watch",
    "test:ci": "ng test --watch=false --browsers=ChromeHeadless",
    "test:coverage": "ng test --code-coverage",
    "quality": "npm run lint && npm run format:check && npm run test:ci"
  }
}
```

## Karma Configuration (karma.conf.js)

```javascript
module.exports = function (config) {
  config.set({
    basePath: "",
    frameworks: ["jasmine", "@angular-devkit/build-angular"],
    browsers: ["Chrome"],
    customLaunchers: {
      ChromeHeadlessCI: {
        base: "ChromeHeadless",
        flags: ["--no-sandbox"],
      },
    },
    reporters: ["progress", "coverage"],
    coverageReporter: {
      dir: "coverage/main-app",
      subdir: ".",
      reporters: [{ type: "html" }, { type: "text-summary" }],
    },
  });
};
```

## EditorConfig (.editorconfig)

```
root = true

[*]
indent_style = space
indent_size = 2
end_of_line = lf
charset = utf-8
trim_trailing_whitespace = true
insert_final_newline = true

[*.md]
trim_trailing_whitespace = false

[{package.json,*.json}]
indent_size = 2
```

## Husky + Lint-Staged (Git Hooks)

**package.json:**

```json
{
  "devDependencies": {
    "husky": "^9.0.0",
    "lint-staged": "^15.0.0"
  },
  "lint-staged": {
    "*.{ts,html}": "eslint --fix",
    "*.{ts,html,scss,md,json}": "prettier --write"
  },
  "scripts": {
    "prepare": "husky"
  }
}
```

**.husky/pre-commit:**

```bash
#!/bin/sh
. "$(dirname "$0")/_/husky.sh"
npx lint-staged
```

## Verification Workflow

```bash
# 1. Check quality pipeline
npm run quality

# 2. Introduce intentional errors
echo "let x: any = 123; x.foo();" >> src/app/app.component.ts
npm run lint  # Should fail

# 3. Fix and verify
npm run lint:fix
npm run format

# 4. Test coverage
npm run test:coverage
```

## Checklist for Completion

**✅ Quality pipeline working when:**

- [ ] `npm run lint` catches Angular/TypeScript errors
- [ ] `npm run format:check` enforces Prettier rules
- [ ] `npm run test:coverage` generates HTML report
- [ ] VS Code auto-fixes on save (ESLint + Prettier)
- [ ] Git pre-commit hooks run (`husky`)
- [ ] `ng lint --fix` auto-corrects issues

**Demo verification:**

```
1-6-linting-formatting-testing-setup/
├── .eslintrc.json                # Angular ESLint rules
├── .prettierrc                   # Formatting config
├── karma.conf.js                 # Test runner
├── tsconfig.spec.json            # Test TypeScript config
├── .vscode/settings.json         # Editor integration
├── .husky/pre-commit             # Git hooks
└── package.json                  # Quality scripts
```

**Next: `1-7-angular-version-updates.md`** - Safe Angular upgrades & migration!

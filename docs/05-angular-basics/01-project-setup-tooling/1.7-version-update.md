# 1.7 Angular Version Updates

**Branch: `1-7-angular-version-updates`**

Safe Angular upgrades maintain stability across major versions (17â†’18â†’19â†’20â†’21). Use automated migrations, rollback strategies, and testing to minimize downtime.

## Update Commands

### Interactive Global Update

```bash
# Check available updates
ng update

# Update Angular + CLI (recommended)
ng update @angular/cli @angular/core

# Update specific packages
ng update @angular/cli@18 @angular/core@18
```

### Non-interactive (CI/CD)

```bash
# Exact version pinning
ng update @angular/core@21.0.0 @angular/cli@21.0.0

# Latest minor/patch
ng update @angular/core@21 @angular/cli@21
```

## Automated Migrations

**Angular provides schematics for 90% of breaking changes:**

```bash
# Migrate to standalone (17+)
ng generate @angular/core:standalone

# Migrate to signals (18+)
ng generate @angular/core:migrate-to-signals

# Update to control flow syntax (17+)
ng generate @angular/core:control-flow

# Migrate ngIf/ngFor to @if/@for (17+)
ng generate @angular/core:module-to-standalone
```

## Update Workflow (Safe)

**Step 1: Backup & Branch**

```bash
git checkout -b update-angular-21
git stash  # Stash uncommitted changes
```

**Step 2: Update Core Packages**

```bash
# Update Angular ecosystem
ng update @angular/cli @angular/core @angular/material

# Update dev dependencies
ng update @angular-devkit/build-angular @angular-eslint/schematics
```

**Step 3: Run Automated Migrations**

```bash
# Review migration plan
ng update @angular/core --dry-run

# Execute migrations
ng update @angular/core --migrate-only
```

**Step 4: Manual Fixes**

```bash
# Fix remaining issues
npm run lint:fix
npm run format
npm run type-check
ng build --configuration production
```

## Update Checklist by Version

### Angular 17â†’18

```
âœ… [ ] Migrate to new control flow (@if/@for/@switch)
âœ… [ ] Update to signal inputs (input())
âœ… [ ] Replace ViewEncapsulation.Emulated with new API
```

### Angular 18â†’19

```
âœ… [ ] Enable zoneless change detection (experimental)
âœ… [ ] Migrate to deferrable views (@defer)
âœ… [ ] Update router to new functional guards
```

### Angular 19â†’20

```
âœ… [ ] Resource signals for data fetching
âœ… [ ] Server-side rendering improvements
âœ… [ ] Enhanced hydration
```

### Angular 20â†’21

```
âœ… [ ] Full zoneless support
âœ… [ ] Signal-based router
âœ… [ ] Improved devtools integration
```

## Rollback Strategy

**package.json backup (before update):**

```json
{
  "dependencies": {
    "@angular/core": "~20.2.0",
    "@angular/cli": "~20.2.0"
  }
}
```

**Rollback commands:**

```bash
# Restore exact versions
npm install @angular/core@20.2.0 @angular/cli@20.2.0

# Clean build artifacts
rm -rf node_modules dist .angular
npm install
ng build
```

## Third-Party Package Updates

```bash
# Angular Material
ng update @angular/material

# RxJS
ng update rxjs

# ESLint
ng update @angular-eslint/schematics

# Testing
ng update @angular-devkit/build-angular
```

## Verification After Update

**Post-update tests:**

```bash
# 1. Type checking
npm run type-check

# 2. Build all configurations
ng build --configuration production
ng build --configuration staging

# 3. Tests + coverage
npm run test:coverage

# 4. E2E tests
ng e2e

# 5. Lint
npm run lint

# 6. Serve production build
npx http-server dist/main-app
```

## Package.json Lockfile Management

**.npmrc (recommended):**

```
save-exact=true
package-lock=true
```

**Update lockfile:**

```bash
rm package-lock.json
npm install
git add package-lock.json
git commit -m "chore: update lockfile"
```

## Continuous Update Scripts

**package.json:**

```json
{
  "scripts": {
    "update:check": "ng update --dry-run",
    "update:major": "ng update @angular/cli @angular/core",
    "update:minor": "ng update @angular/cli @angular/core --allow-major=false",
    "postupdate": "npm run lint:fix && npm run test:ci"
  }
}
```

## Migration Safety Net

**Create update branches:**

```bash
git checkout -b update/21.0.0
ng update @angular/core@21
git push origin update/21.0.0
# Test in CI/CD before merging
```

## Common Breaking Changes & Fixes

| Issue                           | Fix                                    |
| ------------------------------- | -------------------------------------- |
| `NgModule` â†’ `standalone: true` | `ng g @angular/core:standalone`        |
| `ngIf` â†’ `@if`                  | `ng g @angular/core:control-flow`      |
| `ViewEncapsulation` changes     | Update to new `ViewEncapsulation` enum |
| Router guards                   | Migrate to functional guards           |

## Verification Checklist

**âœ… Angular 21 upgrade complete when:**

- [ ] `ng version` shows Angular 21.x.x
- [ ] All migrations run successfully
- [ ] `ng build --prod` succeeds
- [ ] Tests pass with 80%+ coverage
- [ ] Linting passes
- [ ] Production serve works
- [ ] Rollback tested (`npm install @angular/core@20`)

**Demo verification:**

```
1-7-angular-version-updates/
â”œâ”€â”€ MIGRATION.md                 # Migration steps log
â”œâ”€â”€ package.json                 # Angular 21 versions
â”œâ”€â”€ angular.json                 # Updated builders
â””â”€â”€ CHANGELOG.md                 # Breaking changes summary
```

**Next: `2-1-components-basics.md`** - Dive into Angular components!

**ðŸŽ‰ Section 1 complete!** Project setup & tooling mastered. Ready for components!

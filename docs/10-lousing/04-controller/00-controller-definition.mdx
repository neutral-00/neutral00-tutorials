# Controller Definitions

import Tabs from '@theme/Tabs';
import TabItem from '@theme/TabItem';

## About Controller
In the spring MVC architecture, Controller is where request from the clients are handled.\
The entities, repositories and services, we created ealier, represent the Model.


## Steps
1. under `src\java\com\lousing` create a package `controller`
2. create the below classes

<Tabs>
<TabItem value="user" label="UserController.java">

```java title="src/main/java/com/lousing/controller/UserController.java" showLineNumbers
package com.lousing.controller;

import com.lousing.entity.User;
import com.lousing.service.UserService;
import org.slf4j.Logger;
import org.slf4j.LoggerFactory;
import org.springframework.http.HttpStatus;
import org.springframework.http.ResponseEntity;
import org.springframework.web.bind.annotation.*;

import java.util.List;
import java.util.Optional;

@CrossOrigin(origins = "http://localhost:4200", allowedHeaders = "*")
@RestController
@RequestMapping("/api/user")
public class UserController {
    private final UserService userService;
    private  static final Logger logger = LoggerFactory.getLogger(UserController.class);

    public UserController(UserService userService) {
        this.userService = userService;
    }

    @GetMapping
    public List<User> getAllUsers() {
        return userService.getAllUsers();
    }

    @GetMapping("/{id}")
    public ResponseEntity<User> getUserById(@PathVariable Long id){
        Optional<User> user = userService.getUserById(id);
        return user.map(ResponseEntity::ok).orElseGet(() -> ResponseEntity.notFound().build());
    }

    @PostMapping
    public ResponseEntity<?> createUser(@RequestBody User user) {
        logger.info("Inside - CREATE_USER");
        try {
            user.getEmails().forEach(email -> email.setUser(user));
            User savedUser = userService.saveUser(user);
            return ResponseEntity.ok(savedUser);
        } catch (Exception e) {
            logger.error(e.getMessage()); // Log the full stack trace
            return ResponseEntity.status(HttpStatus.BAD_REQUEST).body("Error creating user: " + e.getMessage());
        }
    }

    @PutMapping("/{id}")
    public ResponseEntity<User> updateUser(@PathVariable Long id, @RequestBody User userDetails) {
        logger.info("Inside - UPDATE_USER");
        Optional<User> userOptional = userService.getUserById(id);
        if (userOptional.isPresent()) {
            User existingUser = userOptional.get();

            // Update basic fields
            existingUser.setOfficialName(userDetails.getOfficialName());
            existingUser.setKnownAs(userDetails.getKnownAs());
            existingUser.setMobileNumber(userDetails.getMobileNumber());

            // Ensure emails are properly linked to the existing user
            if (userDetails.getEmails() != null) {
                existingUser.getEmails().clear(); // Clear current emails
                existingUser.getEmails().addAll(userDetails.getEmails()); // Add updated emails
            }
            // Save and return the updated user
            User savedUser = userService.saveUser(existingUser);
            return ResponseEntity.ok(savedUser);
        } else {
            return ResponseEntity.notFound().build();
        }
    }

    @DeleteMapping("/{id}")
    public ResponseEntity<Void> deleteUser(@PathVariable Long id) {
        userService.deleteUserById(id);
        return ResponseEntity.noContent().build();
    }
}

```
</TabItem>
</Tabs>